#!/usr/bin/env nix-shell
#! nix-shell -I nixpkgs=channel:nixos-25.05
#! nix-shell -p nh gum python313 python313Packages.xonsh python313Packages.docopt
#! nix-shell -i xonsh
"""
Rebuilds the system and home configuration.

Usage:
  {program}
  {program} os
  {program} home
  {program} (-h | --help)
  {program} (-v | --version)

Options:
  -h --help         Show this screen.
  -v --version      Show version.
"""
import os

from docopt import docopt

os.chdir(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

def rebuild_system():
  #nixos-rebuild switch --use-remote-sudo --flake '.'
  nh os switch .

def rebuild_home():
  # home-manager switch --flake '.'
  nh home switch .

def main(args):
    if args['os']:
        rebuild_system()
    elif args['home']:
        rebuild_home()
    else:
        rebuild_system()
        rebuild_home()

if __name__ == '__main__':
    arguments = docopt(__doc__.format(program=__file__), version=f'{os.path.basename(__file__)} script version 1.0')
    main(arguments)

# vim: ft=xonsh
